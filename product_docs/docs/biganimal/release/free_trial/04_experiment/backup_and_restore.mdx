---
title: Backup and restore a cluster
navTitle: "Backup and restore" 
indexCards: none
---

BigAnimal [automatically and continuously](/biganimal/latest/using_cluster/04_backup_and_restore/) saves backups of your clusters. You can restore your cluster to any point in the past after the initial backup on cluster creation. That functionality is included in the free trail as well. While that means you don't have to do anything to generate backups, it's always sensible to test your backups.

If you haven't already, [create a cluster](create_cluster_cli) on BigAnimal. For the free trial, you may only have one active cluster. Since this is a demonstration of recovering a cluster from backup, it doesn't matter whether you start a new cluster or just restore your current cluster to its current state.

We're going to [add a database]((/biganimal/latest/using_cluster/01_postgres_access/#one-database-with-one-application)) called "baseball" which we will populate with some  Major League Baseball statistics.

```sql
create user baseball with password 'baseball_pwd';
grant baseball to edb_admin;
create database baseball with owner baseball;
```

Now you can switch to your new (and empty) baseball database.
```sql
\c baseball
```

Normally we'd use log files to determine the moment in time that we want to restore. The free trial doesn't provide access to the logs, however. So that we have accurate timing of our activities, let's change the prompt to include a timestamp.
```sql
\set PROMPT1 '%`date +%H:%M:%S` %/%R%# '
```

For this demonstration, we're just going to import batter data from the [Baseball Databank](https://github.com/chadwickbureau/baseballdatabank), which is in CSV form. While it's easy to import the data using [PostgreSQL's COPY command](https://www.postgresql.org/docs/current/sql-copy.html), we will need to first define a table to put that data into. Most of the columns are integers, but there are a few strings to consider as well. You can just copy and paste this command into your terminal.
```sql
CREATE TABLE batters (
                      id SERIAL,
                      playerid VARCHAR(9),
                      yearid INTEGER,
                      stint INTEGER,
                      teamid VARCHAR(3),
                      lgid VARCHAR(2),
                      g INTEGER,
                      ab INTEGER,
                      r INTEGER,
                      h INTEGER,
                      "2b" INTEGER,
                      "3b" INTEGER,
                      hr INTEGER,
                      rbi INTEGER,
                      sb INTEGER,
                      cs INTEGER,
                      bb INTEGER,
                      so INTEGER,
                      ibb INTEGER,
                      hbp INTEGER,
                      sh INTEGER,
                      sf INTEGER,
                      gidp INTEGER,
                      PRIMARY KEY (id)
);
```

Now we can populate the table from the internet using the most recent data.
```sql
\COPY batters(playerid,yearid,stint,teamid,lgid,g,ab,r,h,"2b","3b",hr,rbi,sb,cs,bb,so,ibb,hbp,sh,sf,gidp) FROM PROGRAM 'curl "https://raw.githubusercontent.com/chadwickbureau/baseballdatabank/master/core/Batting.csv"' DELIMITER ',' CSV HEADER
```

Just to prove there's data loaded, let's look at the homerun leaders for the 1998 season.
```sql
SELECT playerid, yearid, teamid,
       rank() OVER (PARTITION BY yearid ORDER BY hr desc) hr_rank,
       hr
FROM batters
WHERE yearid = 1998
ORDER BY hr_rank LIMIT 5;
```

Suppose someone wanted to revise history a bit. 
```sql
UPDATE batters 
SET hr=0 
where playerid = 'mcgwima01' AND yearid = 1998;
```

Note the time so we can restore that data later. Verify the data has been changed by re-running the 1998 homerun leader query. Now for good measure, go ahead and drop the whole table.
```sql
DROP TABLE batters;
```

You can verify the table is gone by looking at the list of tables.
```sql
\dt
```

For the free trial, you are limited to one active cluster. Restoring a cluster creates a brand new cluster that is initialized with the cluster backup. Quit psql (`\q`) and delete the cluster from the command line.
```shell
./biganimal delete-cluster --id p-xxxxxxxxxxx
```

Restore the cluster using the timestamp before the time you dropped the table. (This currently requires using the web interface.)

Check the status of the new cluster from the command line.
```shell
./biganimal show-clusters
```

Log into the new cluster. Again use the edb_admin password used when creating the cluster you recently deleted.

Verify that the batters table has been restored:
```sql
select playerid, yearid, teamid,
       rank() OVER (PARTITION BY yearid ORDER BY hr desc) hr_rank,
       hr
from batters
where yearid = 1998
order by hr_rank limit 5;
```
 
