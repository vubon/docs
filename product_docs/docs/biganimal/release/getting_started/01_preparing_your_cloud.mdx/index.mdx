---
title: "Before connecting to your cloud"
---

Set up your cloud account before connecting to BigAnimal.

## Before you connect your Azure account

1.  Ensure you have an active Microsoft Azure subscription. If you need to create one, see [Create an additional Azure subscription](https://docs.microsoft.com/en-us/azure/cost-management-billing/manage/create-subscription).

2.  In Azure Active Directory, ensure your role is owner and your user type is member (not guest) for the subscription you are using.

3.  Create an Azure Active Directory Application client to delegate Identity and Access Management functions to Azure Active Directory (AD). You can create the Azure Active Directory Application using the Azure Portal, but a simpler and less error-prone approach is to use the `create-spn` script (see [Create Azure Active Directory Application using `create-spn`](#create-azure-active-directory-application-using-create-spn)). The script approach requires the Azure API.

!!! Note
    Some steps of the subscription process require approval of an Azure AD administrator.
    Your Azure role in the Azure AD must be either:

    -   Global Administrator
    -   Privileged Role Administrator

    or you need the cooperation of a user with one of those roles in your organization.

### Create Azure Active Directory Application using the Azure portal

!!! Note
    Create your Azure AD Application in the same tenant as the subscription you want to associate it with.Â 

1.  Register an application with Azure AD and create a service principal. See [Register an application with Azure AD and create a service principal](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#register-an-application-with-azure-ad-and-create-a-service-principal) for instructions.
    Take note of the **Application (client) ID**, as you need it to configure your BigAnimal account. Also take note of the **Display name** value of the Azure AD application. You need to enter this value later.

2.  Select *application secret* as an authentication option for the application. See [Create a new Azure AD application secret](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#option-2-create-a-new-application-secret) for instructions. Take note of the Azure AD App Secret, as you need it to configure your cloud account.

3.  Select *API permissions* to configure API permissions for the application. See [Configure a client application to access Azure Active Directory API](https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/howto-configure-prerequisites-for-reporting-api) for instructions. Add Application permissions with Microsoft Graph *Application.ReadWrite.OwnedBy* and *Directory.Read.All* to your application and grant admin consent for your cloud account.

4.  Assign the owner role to the application. See [Assign a role to the application](https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#assign-a-role-to-the-application) for instructions. In the **Select** field of the **Add role assignment** panel, enter the display name of the Azure AD application. See [Open the Add role assignment pane](https://docs.microsoft.com/en-us/azure/role-based-access-control/role-assignments-portal?tabs=current#step-2-open-the-add-role-assignment-page) for instructions.

### Create Azure Active Directory Application using `create-spn`

To simplify the process of creating an Azure AD Application, EDB provides the `create-spn` script for Azure API users (available [here](https://github.com/EnterpriseDB/cloud-utilities/blob/main/azure)). The script automates the creation of the Active Directory Application. 
Before using the script, ensure that these utilities are installed on your machine:

-   [jq command-line JSON processor](https://stedolan.github.io/jq/)
-   [azure cli](https://docs.microsoft.com/en-us/cli/azure/) v2.26 or above

Alternatively, you can run the script in [Azure Cloud Shell](https://azure.microsoft.com/en-us/features/cloud-shell/?ef_id=CjwKCAiA3L6PBhBvEiwAINlJ9Pj1wF0QH8KpGtC5Z4qIy21h5fcsP7tDYtBPxNLP-UMFaIiQY-EEuhoCppEQAvD_BwE%3AG%3As&OCID=AID2200202_SEM_CjwKCAiA3L6PBhBvEiwAINlJ9Pj1wF0QH8KpGtC5Z4qIy21h5fcsP7tDYtBPxNLP-UMFaIiQY-EEuhoCppEQAvD_BwE%3AG%3As&gclid=CjwKCAiA3L6PBhBvEiwAINlJ9Pj1wF0QH8KpGtC5Z4qIy21h5fcsP7tDYtBPxNLP-UMFaIiQY-EEuhoCppEQAvD_BwE#overview).

The syntax of the command is:

```
curl -sL https://raw.githubusercontent.com/EnterpriseDB/cloud-utilities/main/azure/create-spn.sh | bash -s -- \
--display-name <display-name> \
--subscription <subscription> \
--years <years>
```

Flag and option details:

| Flag/option shortcut | Flag/option long name            | Description                                                                                                |
| -------------------- | -------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| -d &lt;display-name>            | --display-name &lt;display-name>            | Name of Azure AD Application.                                                                              |
| -s &lt;subscription> | --subscription &lt;subscription> | Azure Subscription ID used by BigAnimal.                                                                   |
| -y &lt;years>           | --years &lt;years>                  | Integer value specifying the number of years for which the credentials are valid. The default is one year. |
| -h                   | --help                           | Displays information on the syntax and usage of the script.                                                |

The script creates the Azure AD Service Principal and configures its access to Azure resources in the specified subscription.

The specific output includes the client ID and client secret you use when you configure your account. See [Step 4. Configure your account](#4-configure-your-account).

#### Example

To create an Azure AD Application with the subscription ID  `c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712` and display name `hello-s`:

```
curl -sL https://raw.githubusercontent.com/EnterpriseDB/cloud-utilities/main/azure/create-spn.sh | bash -s -- \
--display-name "hello-s" \
--subscription c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712 \
--years 2
Change to use Azure Subscription c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712...
{
  "environmentName": "AzureCloud",
  "homeTenantId": "fb0cxxxx-xxxx-xxxx-xxxx-xxxxxxxx3d0f",
  "id": "c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712",
  "isDefault": true,
  "managedByTenants": [],
  "name": "development",
  "state": "Enabled",
  "tenantId": "fb0cxxxx-xxxx-xxxx-xxxx-xxxxxxxx3d0f",
  "user": {
    "name": "xxxx",
    "type": "user"
  }
}
Creating Azure AD Service Principal and configuring its access to Azure resources in subscription c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712...
Waiting 15 seconds for Azure AD Service Principal to propagate...
Add Azure AD Service Principal Owners...
{
  "client_id": "a756xxxx-xxxx-xxxx-xxxx-xxxxxxxx84da",
  "client_secret": "xxxx",
  "subscription": "c808xxxx-xxxx-xxxx-xxxx-xxxxxxxxb712"
}
```

If you receive the following error message, you need to request admin consent for your cloud account. Only users with the Azure AD Global Administrator or Privileged Role Administrator role can grant admin consent.

```
...
Error: Please request Azure AD Global Administrator or Privileged Role Administrator to grant admin consent permissions for Service Principal hello-s(77bbxxxx-xxxx-xxxx-xxxx-xxxxxxxx7c54)
```